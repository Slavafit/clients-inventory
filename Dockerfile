# 1. Используем официальный легковесный образ Node.js
FROM node:20-slim

# 2. Устанавливаем рабочую директорию внутри контейнера
WORKDIR /usr/src/app

# 3. Копируем файлы манифеста и устанавливаем зависимости
# Это позволяет Docker кэшировать npm install, если package.json не менялся
COPY package*.json ./
RUN npm install --only=production

# 4. Копируем весь остальной код приложения в контейнер
COPY . .

# 5. Обязательно устанавливаем зависимость 'concurrently', если она нужна в продакшене
# (так как в пункте 3 мы использовали --only=production)
# Если 'concurrently' в devDependencies, его нужно явно установить или убрать --only=production
# Предполагаем, что вы используете 'concurrently' как dev-зависимость, но для старта он нужен
# Если вы используете 'npm run start', как рекомендовано, этот шаг может быть не нужен, 
# если вы установили все зависимости изначально. Для чистоты:
RUN npm install concurrently

# 6. Открываем порт, на котором работает ваш WhatsApp Webhook
EXPOSE 3000

# 7. Определяем команду для запуска приложения
# Предполагаем, что в package.json есть скрипт "start", который запускает оба файла
CMD ["npm", "start"]